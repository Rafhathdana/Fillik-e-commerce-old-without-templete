<header><%- include('header') -%></header>

<div
  class="d-flex flex-column flex-shrink-0 bg-body-tertiary"
  style="width: 4.5rem"
>
  <a
    href="/"
    class="d-block p-3 link-body-emphasis text-decoration-none"
    title="Icon-only"
    data-bs-toggle="tooltip"
    data-bs-placement="right"
  >
    <svg class="bi pe-none" width="40" height="32">
      <use xlink:href="#bootstrap" />
    </svg>
    <span class="visually-hidden">Icon-only</span>
  </a>
  <ul class="nav nav-pills nav-flush flex-column mb-auto text-center">
    <li class="nav-item">
      <a
        href="#"
        class="nav-link active py-3 border-bottom rounded-0"
        aria-current="page"
        title="Home"
        data-bs-toggle="tooltip"
        data-bs-placement="right"
      >
        <svg
          class="bi pe-none"
          width="24"
          height="24"
          role="img"
          aria-label="Home"
        >
          <use xlink:href="#home" />
        </svg>
      </a>
    </li>
    <li>
      <a
        href="#"
        class="nav-link py-3 border-bottom rounded-0"
        title="Dashboard"
        data-bs-toggle="tooltip"
        data-bs-placement="right"
      >
        <svg
          class="bi pe-none"
          width="24"
          height="24"
          role="img"
          aria-label="Dashboard"
        >
          <use xlink:href="#speedometer2" />
        </svg>
      </a>
    </li>
    <li>
      <a
        href="#"
        class="nav-link py-3 border-bottom rounded-0"
        title="Orders"
        data-bs-toggle="tooltip"
        data-bs-placement="right"
      >
        <svg
          class="bi pe-none"
          width="24"
          height="24"
          role="img"
          aria-label="Orders"
        >
          <use xlink:href="#table" />
        </svg>
      </a>
    </li>
    <li>
      <a
        href="#"
        class="nav-link py-3 border-bottom rounded-0"
        title="Products"
        data-bs-toggle="tooltip"
        data-bs-placement="right"
      >
        <svg
          class="bi pe-none"
          width="24"
          height="24"
          role="img"
          aria-label="Products"
        >
          <use xlink:href="#grid" />
        </svg>
      </a>
    </li>
    <li>
      <a
        href="#"
        class="nav-link py-3 border-bottom rounded-0"
        title="Customers"
        data-bs-toggle="tooltip"
        data-bs-placement="right"
      >
        <svg
          class="bi pe-none"
          width="24"
          height="24"
          role="img"
          aria-label="Customers"
        >
          <use xlink:href="#people-circle" />
        </svg>
      </a>
    </li>
  </ul>
  <div class="dropdown border-top">
    <a
      href="#"
      class="d-flex align-items-center justify-content-center p-3 link-body-emphasis text-decoration-none dropdown-toggle"
      data-bs-toggle="dropdown"
      aria-expanded="false"
    >
      <img
        src="https://github.com/mdo.png"
        alt="mdo"
        width="24"
        height="24"
        class="rounded-circle"
      />
    </a>
    <ul class="dropdown-menu text-small shadow">
      <li><a class="dropdown-item" href="#">New project...</a></li>
      <li><a class="dropdown-item" href="#">Settings</a></li>
      <li><a class="dropdown-item" href="#">Profile</a></li>
      <li><hr class="dropdown-divider" /></li>
      <li><a class="dropdown-item" href="#">Sign out</a></li>
    </ul>
  </div>
</div>

<div class="heading">Users Details</div>
<div class="flex" style="width: 90%; margin-left: 80%">
  <div class="dropdown me-auto">
    <button
      class="btn btn-secondary dropdown-toggle"
      type="button"
      id="dropdownMenuButton"
      data-bs-toggle="dropdown"
      aria-expanded="false"
    >
      count
    </button>

    <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton">
      <li><a class="dropdown-item" href="?count=10&page=1">10</a></li>
      <li><a class="dropdown-item" href="?count=25&page=1">25</a></li>
      <li><a class="dropdown-item" href="?count=50&page=1">50</a></li>
    </ul>
  </div>
</div>
<div class="table-responsive">
  <table class="table">
    <thead>
      <tr>
        <th>Email <a class="ass">^</a><a class="des">^</a></th>
        <th>
          Full Name <a href="?ascending" class="ass">^</a
          ><a href="?ascending" class="des">^</a>
        </th>
        <th>
          No. of Orders <a href="?ascending" class="ass">^</a
          ><a href="?ascending" class="des">^</a>
        </th>
        <th>
          Complaints<a href="?ascending" class="ass">^</a
          ><a href="?ascending" class="des">^</a>
        </th>
        <th>
          Actions<a href="?ascending" class="ass">^</a
          ><a href="?ascending" class="des">^</a>
        </th>
      </tr>
    </thead>
    <tbody>
      <% for (let i = locals.startIndex; i < locals.endIndex; i++) { %>
      <tr>
        <td><%= usersList[i].email %></td>
        <td><%= usersList[i].fullName %></td>
        <td>0</td>
        <td>
          <div class="complaint-box">
            <span class="complaint-number">2</span>
          </div>
        </td>
        <td>
          <div class="d-flex">
            <% if(usersList[i].isActive){%>
            <div
              class="action-box mx-3"
              onclick="confirmStatus('<%= usersList[i]._id %>')"
            >
              <span class="action-text">Block </span>
            </div>
            <% } else { %>
            <div
              class="action-box red mx-3"
              onclick="confirmStatus('<%= usersList[i]._id %>')"
            >
              <span class="action-text">Unblock </span>
            </div>
            <% } %>
            <div class="action-box">
              <a href="#" class="details-link">Details</a>
            </div>
          </div>
        </td>
      </tr>
      <% } %>
    </tbody>
  </table>
</div>
<div class="pagenumbers">
  <% for (let i = 1; i <= locals.totalPages; i++) { %>
  <a
    href="?count=<%= count %>&page=<%= i %>"
    class="page<%= i === parseInt(page) ? ' active' : '' %>"
    ><%= i %></a
  >
  <% } %>
</div>
<div class="nextprev">
  <% if (locals.page > 1) { %>
  <a href="?count=<%= count %>&page=<%= parseInt(page) - 1 %>" class="prev"
    >Prev</a
  >
  <% } %> <% if (locals.page < locals.totalPages) { %>
  <a href="?count=<%= count %>&page=<%= parseInt(page) + 1 %>" class="next"
    >Next</a
  >
  <% } %>
</div>

<script>
  function confirmStatus(userId) {
    if (confirm("Are you sure you want to Block this user?")) {
      fetch(`statusUserUpdate/${userId}`, { method: "POST" })
        .then((res) => {
          if (res.ok) {
            window.location.reload();
          } else {
            alert("unable to update user");
          }
        })
        .catch((err) => {
          console.error(err);
          alert("Internal server error");
        });
    } else {
      // User cancelled, do nothing
      console.log("User cancelled Blocking of user ID", userId);
    }
  }
</script>

<!-- Include the Bootstrap CSS -->
